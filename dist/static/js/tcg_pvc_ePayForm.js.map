{"version":3,"sources":["webpack:///./node_modules/@phila/pinboard/node_modules/escape-html/index.js","webpack:///./node_modules/@phila/pinboard/node_modules/@phila/vue-comps/src/components/ePayForm.vue?13e2","webpack:///./node_modules/@phila/pinboard/node_modules/@phila/vue-comps/src/util/generate-billing-xml.js","webpack:///node_modules/@phila/pinboard/node_modules/@phila/vue-comps/src/components/ePayForm.vue","webpack:///./node_modules/@phila/pinboard/node_modules/@phila/vue-comps/src/components/ePayForm.vue?517c","webpack:///./node_modules/@phila/pinboard/node_modules/@phila/vue-comps/src/components/ePayForm.vue"],"names":["matchHtmlRegExp","escapeHtml","string","escape","str","match","exec","html","index","lastIndex","length","charCodeAt","substring","module","exports","render","_vm","this","_h","$createElement","_c","_self","attrs","actionAddress","domProps","xmlData","directives","name","rawName","value","expression","staticClass","style","$props","slots","text","staticRenderFns","data","console","log","address","zipCode","Object","keys","timestamp","format","Date","xmlString","balances","accountNum","totalDue","property","ownerName","streetAddress","mixins","parseData","$store","state","sources","tips","buttonStyle","options","height","computed","geocode","properties","zip_code","message","evaluateSlot","class","shouldShowButton","created","calculateTotalDue","commit","mounted","$data","methods","years","reduce","acc","yearTotal","calculateTotalForYear","amounts","component"],"mappings":"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","file":"static/js/tcg_pvc_ePayForm.js","sourcesContent":["/*!\n * escape-html\n * Copyright(c) 2012-2013 TJ Holowaychuk\n * Copyright(c) 2015 Andreas Lubbe\n * Copyright(c) 2015 Tiancheng \"Timothy\" Gu\n * MIT Licensed\n */\n\n'use strict';\n\n/**\n * Module variables.\n * @private\n */\n\nvar matchHtmlRegExp = /[\"'&<>]/;\n\n/**\n * Module exports.\n * @public\n */\n\nmodule.exports = escapeHtml;\n\n/**\n * Escape special characters in the given string of html.\n *\n * @param  {string} string The string to escape for inserting into HTML\n * @return {string}\n * @public\n */\n\nfunction escapeHtml(string) {\n  var str = '' + string;\n  var match = matchHtmlRegExp.exec(str);\n\n  if (!match) {\n    return str;\n  }\n\n  var escape;\n  var html = '';\n  var index = 0;\n  var lastIndex = 0;\n\n  for (index = match.index; index < str.length; index++) {\n    switch (str.charCodeAt(index)) {\n      case 34: // \"\n        escape = '&quot;';\n        break;\n      case 38: // &\n        escape = '&amp;';\n        break;\n      case 39: // '\n        escape = '&#39;';\n        break;\n      case 60: // <\n        escape = '&lt;';\n        break;\n      case 62: // >\n        escape = '&gt;';\n        break;\n      default:\n        continue;\n    }\n\n    if (lastIndex !== index) {\n      html += str.substring(lastIndex, index);\n    }\n\n    lastIndex = index + 1;\n    html += escape;\n  }\n\n  return lastIndex !== index\n    ? html + str.substring(lastIndex, index)\n    : html;\n}\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('form',{attrs:{\"action\":_vm.actionAddress,\"method\":\"post\",\"target\":\"_blank\"}},[_c('input',{attrs:{\"name\":\"billStmt\",\"type\":\"hidden\"},domProps:{\"value\":_vm.xmlData}}),_c('input',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.shouldShowButton),expression:\"shouldShowButton\"}],staticClass:\"button external\",style:(_vm.buttonStyle),attrs:{\"type\":\"submit\"},domProps:{\"value\":this.$props.slots.text}})])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import { format, formatISO } from 'date-fns';\r\nimport escapeHtml from 'escape-html';\r\n\r\n/*\r\n  this is a helper fn that accepts a data object containing the following:\r\n\r\n    - accountNum <String>\r\n    - amountDue <Number>\r\n    - owner <String>\r\n    - address <Object>\r\n      - streetAddress <String>\r\n      - city <String>\r\n      - state <String>\r\n      - postalCode <String>\r\n      - country <String>\r\n\r\n  and returns a serialized xml object which the epay gateway can accept for\r\n  initiating a purchase.\r\n\r\n  REVIEW does this need to handle credits?\r\n*/\r\n\r\nexport default function (data) {\r\n  console.log('pvc generate billing xml, data:', data, 'data.address.zipCode:', data.address.zipCode);\r\n\r\n  // if data object is empty, return empty string\r\n  if (Object.keys(data).length < 1) {\r\n    return '';\r\n  }\r\n\r\n  // get the current date/time in iso format with timezone\r\n  // let timestamp = formatISO(new Date());\r\n  let timestamp = format(new Date(), \"yyyy-MM-dd'T'HH:mm:ssxxx\");\r\n  console.log('timestamp in pvc gb:', timestamp);\r\n\r\n  // TODO use a json to xml lib instead of forming this string?\r\n  const xmlString = `<?xml version=\"1.0\" encoding=\"utf-16\"?>\r\n<BillingStatement xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\">\r\n  <ApplicationID>fcd68fd2-e923-4b03-a0e7-a678c2ed612a</ApplicationID>\r\n  <AccountNumber />\r\n  <BillNumber>${data.balances.accountNum}</BillNumber>\r\n  <StatementNumber />\r\n  <BillingDate>${timestamp}</BillingDate>\r\n  <DueDate>${timestamp}</DueDate>\r\n  <TotalDue>${data.totalDue}</TotalDue>\r\n  <DepartMentId>0</DepartMentId>\r\n  <Fund>0</Fund>\r\n  <PaymentDate>0001-01-01T00:00:00</PaymentDate>\r\n  <Quantity>0</Quantity>\r\n  <ItemAmount>0</ItemAmount>\r\n  <TotalAmountdue>0</TotalAmountdue>\r\n  <PartialPaymentFlag>false</PartialPaymentFlag>\r\n  <ReceiptpresentFlag>false</ReceiptpresentFlag>\r\n  <Details>\r\n    <BillingStatementDetail>\r\n      <ItemDate>${timestamp}</ItemDate>\r\n      <ItemDescription>Real Estate Tax</ItemDescription>\r\n      <Charges>${data.totalDue}</Charges>\r\n      <Credits>0</Credits>\r\n    </BillingStatementDetail>\r\n  </Details>\r\n  <Customers>\r\n    <Customer>\r\n      <FirstName>${data.balances.property.ownerName}</FirstName>\r\n      <MiddleName />\r\n      <LastName />\r\n      <BillingAddress>\r\n        <Address>\r\n          <AddressLine1>${data.address.streetAddress}</AddressLine1>\r\n          <City>PHILADELPHIA</City>\r\n          <State>PA</State>\r\n          <PostalCode>${data.address.zipCode}</PostalCode>\r\n          <Country>US</Country>\r\n        </Address>\r\n      </BillingAddress>\r\n    </Customer>\r\n  </Customers>\r\n</BillingStatement>\r\n  `;\r\n\r\n  return escapeHtml(xmlString);\r\n}\r\n","<template>\r\n  <!-- <form action=\"https://test-secure.phila.gov/PaymentCenter/Gateway1/InitiatePurchase.aspx\" -->\r\n  <form\r\n    :action=\"actionAddress\"\r\n    method=\"post\"\r\n    target=\"_blank\"\r\n  >\r\n    <input\r\n      :value=\"xmlData\"\r\n      name=\"billStmt\"\r\n      type=\"hidden\"\r\n    >\r\n    <input\r\n      v-show=\"shouldShowButton\"\r\n      :value=\"this.$props.slots.text\"\r\n      :style=\"buttonStyle\"\r\n      type=\"submit\"\r\n      class=\"button external\"\r\n    >\r\n  </form>\r\n</template>\r\n\r\n<script>\r\nimport TopicComponent from './TopicComponent.vue';\r\nimport generateBillingXml from '../util/generate-billing-xml';\r\n\r\nconst BALANCE_PARTS = [\r\n  'principal',\r\n  'interest',\r\n  'penalty',\r\n  'other',\r\n];\r\n\r\nexport default {\r\n  mixins: [ TopicComponent ],\r\n  data() {\r\n    const data = {\r\n      parseData: {\r\n        'accountNum': this.$store.state.sources.tips.data.data.accountNum,\r\n        'totalDue': '',\r\n        'balances': this.$store.state.sources.tips.data.data,\r\n        'address': {\r\n          'streetAddress':  this.$store.state.sources.tips.data.data.property.address,\r\n          'zipCode': this.zipCode,\r\n        },\r\n      },\r\n      xmlData: {},\r\n      buttonStyle: 'height: ' + this.$props.options.height + 'px;\\\r\n         width: ' + this.$props.options.width + 'px;\\\r\n         font-size: ' + this.$props.options.fontSize + 'px;\\\r\n         ',\r\n      actionAddress: this.$props.options.actionAddress || 'https://test-secure.phila.gov/PaymentCenter/Gateway1/InitiatePurchase.aspx',\r\n    };\r\n    return data;\r\n  },\r\n  computed: {\r\n    // this was added to allow fetchData to run even without a geocode result\r\n    // for the real estate tax site which sometimes needs data from TIPS\r\n    // even if the property is not in OPA and AIS\r\n    zipCode() {\r\n      // console.log('ePayForm zipCode computed');\r\n      if (this.$store.state.geocode.data) {\r\n        return this.$store.state.geocode.data.properties.zip_code;\r\n      }\r\n      return '';\r\n\r\n    },\r\n    message() {\r\n      let value;\r\n      if (this.$props.slots) {\r\n        value = this.evaluateSlot(this.$props.slots.text);\r\n      }\r\n      return value;\r\n    },\r\n    class() {\r\n      let value;\r\n      if (this.$props.options) {\r\n        value = this.$props.options.class || '';\r\n      }\r\n      return value;\r\n    },\r\n    style() {\r\n      let value;\r\n      if (this.$props.options) {\r\n        value = this.$props.options.style || '';\r\n      }\r\n      return value;\r\n    },\r\n    shouldShowButton() {\r\n      if (this.parseData.totalDue > 0) {\r\n        return true;\r\n      }\r\n      return false;\r\n\r\n    },\r\n  },\r\n  created() {\r\n    // console.log('ePayForm created is running, this.zipCode:', this.zipCode)\r\n    this.parseData.totalDue = this.calculateTotalDue();\r\n    this.$store.commit('setPropertyBalance', this.parseData.totalDue);\r\n  },\r\n  mounted() {\r\n    // console.log('ePayForm mounted, this.zipCode:', this.zipCode);\r\n    this.$data.parseData.address.zipCode = this.zipCode;\r\n    this.xmlData = generateBillingXml(this.parseData);\r\n  },\r\n  methods: {\r\n    calculateTotalDue() {\r\n      return this.parseData.balances.years.reduce((acc, year) => {\r\n        const yearTotal = this.calculateTotalForYear(year);\r\n        return acc + yearTotal;\r\n      }, 0);\r\n    },\r\n    calculateTotalForYear(year) {\r\n      const amounts = BALANCE_PARTS.map(part => year[part]);\r\n      return amounts.reduce((acc, amount) => acc + amount, 0);\r\n    },\r\n  },\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n\r\n</style>\r\n","import mod from \"-!../../../../../../../cache-loader/dist/cjs.js??ref--12-0!../../../../../../../thread-loader/dist/cjs.js!../../../../../../../babel-loader/lib/index.js!../../../../../../../cache-loader/dist/cjs.js??ref--0-0!../../../../../../../vue-loader/lib/index.js??vue-loader-options!./ePayForm.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../../../cache-loader/dist/cjs.js??ref--12-0!../../../../../../../thread-loader/dist/cjs.js!../../../../../../../babel-loader/lib/index.js!../../../../../../../cache-loader/dist/cjs.js??ref--0-0!../../../../../../../vue-loader/lib/index.js??vue-loader-options!./ePayForm.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./ePayForm.vue?vue&type=template&id=21c4cbd9&scoped=true&\"\nimport script from \"./ePayForm.vue?vue&type=script&lang=js&\"\nexport * from \"./ePayForm.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../../../vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"21c4cbd9\",\n  null\n  \n)\n\nexport default component.exports"],"sourceRoot":""}