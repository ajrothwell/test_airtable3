{"version":3,"sources":["webpack:///./node_modules/@phila/vue-mapping/src/mapbox/UI/withSelfEvents.js","webpack:///./node_modules/@phila/vue-mapping/src/mapbox/lib/withEvents.js","webpack:///./node_modules/@phila/vue-mapping/src/mapbox/UI/Marker.vue?9d29","webpack:///node_modules/@phila/vue-mapping/src/mapbox/UI/Marker.vue","webpack:///./node_modules/@phila/vue-mapping/src/mapbox/UI/Marker.vue?7ccf","webpack:///./node_modules/@phila/vue-mapping/src/mapbox/UI/Marker.vue"],"names":["methods","$_emitSelfEvent","event","data","this","$_emitMapEvent","control","$_bindSelfEvents","events","emitter","Object","keys","$listeners","forEach","eventName","includes","on","$_unbindSelfEvents","length","off","$_emitEvent","name","$emit","map","component","type","mapboxEvent","render","_vm","_h","$createElement","_c","_self","staticStyle","_t","_e","staticRenderFns","drag","dragstart","dragend","click","mouseenter","mouseleave","mixins","inject","provide","self","marker","props","offset","default","coordinates","Array","required","color","String","anchor","draggable","Boolean","initial","undefined","watch","setLngLat","lngLat","setDraggable","next","mounted","$slots","markerOptions","element","elm","mapbox","Marker","newCoordinates","target","_lngLat","eventNames","$_addMarker","beforeDestroy","remove","addTo","$_bindMarkerDOMEvents","values","markerDOMEvents","key","togglePopup"],"mappings":"mLAAe,QACbA,QAAS,CACPC,gBADO,SACSC,GAAkB,IAAXC,EAAW,uDAAJ,GAE5BC,KAAKC,eAAeH,EAApB,gBAA6BI,QAASF,KAAKE,SAAYH,KAMzDI,iBATO,SASUC,EAAQC,GAAS,WAChCC,OAAOC,KAAKP,KAAKQ,YAAYC,SAAQ,SAAAC,GAC/BN,EAAOO,SAASD,IAClBL,EAAQO,GAAGF,EAAW,EAAKb,qBAKjCgB,mBAjBO,SAiBYT,EAAQC,GAAS,WACZ,IAAlBD,EAAOU,QAGNT,GAGLD,EAAOK,SAAQ,SAAAC,GACbL,EAAQU,IAAIL,EAAW,EAAKb,wB,8DC1BrB,QACbD,QAAS,CAOPoB,YAPO,SAOKC,GAAiB,IAAXlB,EAAW,uDAAJ,GAEvBC,KAAKkB,MAAMD,EAAX,gBACEE,IAAKnB,KAAKmB,IACVC,UAAWpB,MACRD,KASPE,eArBO,SAqBQH,GAAkB,IAAXC,EAAW,uDAAJ,GAE3BC,KAAKgB,YAAYlB,EAAMuB,KAAvB,gBAA+BC,YAAaxB,GAAUC,Q,2CCxB5D,IAAIwB,EAAS,WAAa,IAAIC,EAAIxB,KAASyB,EAAGD,EAAIE,eAAmBC,EAAGH,EAAII,MAAMD,IAAIF,EAAG,OAAOE,EAAG,MAAM,CAACE,YAAY,CAAC,QAAU,SAAS,CAACL,EAAIM,GAAG,UAAWN,EAAU,OAAEA,EAAIM,GAAG,WAAWN,EAAIO,MAAM,IACjMC,EAAkB,G,4GCYtB,GACEC,KAAM,OACNC,UAAW,YACXC,QAAS,WAGX,GACEC,MAAO,QACPC,WAAY,aACZC,WAAY,cAGd,GACErB,KAAM,YACNsB,OAAQ,CAAC,EAAX,aAEEC,OAAQ,CAAC,SAAX,OAEEC,QANF,WAOI,IAAJ,OACI,MAAO,CACL,aACE,OAAOC,EAAKC,UAKlBC,MAAO,CAELC,OAAQ,CACNxB,KAAM,CAAC,OAAb,OACMyB,QAAS,WAAf,cAEIC,YAAa,CACX1B,KAAM2B,MACNC,UAAU,GAEZC,MAAO,CACL7B,KAAM8B,QAERC,OAAQ,CACN/B,KAAM8B,OACNL,QAAS,UAEXO,UAAW,CACThC,KAAMiC,QACNR,SAAS,IAIb/C,KAtCF,WAuCI,MAAO,CACLwD,SAAS,EACTZ,YAAQa,IAIZC,MAAO,CACLV,YADJ,SACA,GACU/C,KAAKuD,SAGTvD,KAAK2C,OAAOe,UAAUC,IAExBN,UAPJ,SAOA,GACUrD,KAAKuD,SAGTvD,KAAK2C,OAAOiB,aAAaC,KAI7BC,QA5DF,WA4DA,WACA,oBACA,aAEQ9D,KAAK+D,OAAOpB,SACdqB,EAAcC,QAAUjE,KAAK+D,OAAOpB,OAAO,GAAGuB,KAEhDlE,KAAK2C,OAAS,IAAI3C,KAAKmE,OAAOC,OAAOJ,GAEjChE,KAAKQ,WAAW,uBAClBR,KAAK2C,OAAO/B,GAAG,WAAW,SAAhC,GACQ,IAAR,EAEUyD,EADE,EAAZ,6BAC2B,CAAC,EAA5B,yCAE2BvE,EAAMwE,OAAOC,QAEhC,EAAR,iCAII,IAAJ,iBACIvE,KAAKG,iBAAiBqE,EAAYxE,KAAK2C,QAEvC3C,KAAKuD,SAAU,EACfvD,KAAKyE,eAGPC,cAxFF,gBAyFqBlB,IAAbxD,KAAKmB,UAAqCqC,IAAhBxD,KAAK2C,QACjC3C,KAAK2C,OAAOgC,UAIhB/E,QAAS,CACP6E,YADJ,WAEMzE,KAAK2C,OAAOe,UAAU1D,KAAK+C,aAAa6B,MAAM5E,KAAKmB,KACnDnB,KAAK6E,wBACL7E,KAAKgB,YAAY,QAAS,CAAhC,sBAGInB,gBAPJ,SAOA,GACMG,KAAKC,eAAeH,EAAO,CAAjC,sBAGI+E,sBAXJ,WAWA,WACMvE,OAAOC,KAAKP,KAAKQ,YAAYC,SAAQ,SAA3C,GACYH,OAAOwE,OAAOC,GAAiBpE,SAASqE,IAC1C,EAAV,gDACY,EAAZ,0BAMIL,OArBJ,WAsBM3E,KAAK2C,OAAOgC,SACZ3E,KAAKgB,YAAY,YAGnBiE,YA1BJ,WA2BM,OAAOjF,KAAK2C,OAAOsC,iBClJmS,I,YCOxT7D,EAAY,eACd,EACAG,EACAS,GACA,EACA,KACA,KACA,MAIa,aAAAZ,E","file":"static/js/pvm_MglMarker.js","sourcesContent":["export default {\n  methods: {\n    $_emitSelfEvent(event, data = {}) {\n      // console.log('withSelfEvents.js, $emitSelfEvent is running');\n      this.$_emitMapEvent(event, { control: this.control, ...data });\n    },\n    /** Bind events for markers, popups and controls.\n     * MapboxGL JS emits this events on popup or marker object,\n     * so we treat them as 'self' events of these objects\n     */\n    $_bindSelfEvents(events, emitter) {\n      Object.keys(this.$listeners).forEach(eventName => {\n        if (events.includes(eventName)) {\n          emitter.on(eventName, this.$_emitSelfEvent);\n        }\n      });\n    },\n\n    $_unbindSelfEvents(events, emitter) {\n      if (events.length === 0) {\n        return;\n      }\n      if (!emitter) {\n        return;\n      }\n      events.forEach(eventName => {\n        emitter.off(eventName, this.$_emitSelfEvent);\n      });\n    },\n  },\n};\n","export default {\n  methods: {\n    /**\n     * Emit Vue event with additional data\n     *\n     * @param {string} name EventName\n     * @param {Object} [data={}] Additional data\n     */\n    $_emitEvent(name, data = {}) {\n      // console.log('$_emitEvent is running, name:', name, 'data:', data, 'this.map:', this.map);\n      this.$emit(name, {\n        map: this.map,\n        component: this,\n        ...data,\n      });\n    },\n\n    /**\n     * Emit Vue event with Mapbox event as additional data\n     *\n     * @param {Object} event\n     */\n    $_emitMapEvent(event, data = {}) {\n      // console.log('withEvents.js, $_emitMapEvent is running');\n      this.$_emitEvent(event.type, { mapboxEvent: event, ...data });\n    },\n  },\n};\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticStyle:{\"display\":\"none\"}},[_vm._t(\"marker\"),(_vm.marker)?_vm._t(\"default\"):_vm._e()],2)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <div style=\"display: none\">\n    <!-- slot for custom marker -->\n    <slot name=\"marker\" />\n    <!-- slot for popup -->\n    <slot v-if=\"marker\" />\n  </div>\n</template>\n\n<script>\nimport withEvents from \"../lib/withEvents\";\nimport withSelfEvents from \"./withSelfEvents\";\n\nconst markerEvents = {\n  drag: \"drag\",\n  dragstart: \"dragstart\",\n  dragend: \"dragend\",\n};\n\nconst markerDOMEvents = {\n  click: \"click\",\n  mouseenter: \"mouseenter\",\n  mouseleave: \"mouseleave\",\n};\n\nexport default {\n  name: \"MapMarker\",\n  mixins: [ withEvents, withSelfEvents ],\n\n  inject: [ \"mapbox\", \"map\" ],\n\n  provide() {\n    const self = this;\n    return {\n      get marker() {\n        return self.marker;\n      },\n    };\n  },\n\n  props: {\n    // mapbox marker options\n    offset: {\n      type: [ Object, Array ],\n      default: () => [ 0, 0 ],\n    },\n    coordinates: {\n      type: Array,\n      required: true,\n    },\n    color: {\n      type: String,\n    },\n    anchor: {\n      type: String,\n      default: \"center\",\n    },\n    draggable: {\n      type: Boolean,\n      default: false,\n    },\n  },\n\n  data() {\n    return {\n      initial: true,\n      marker: undefined,\n    };\n  },\n\n  watch: {\n    coordinates(lngLat) {\n      if (this.initial) {\n        return;\n      }\n      this.marker.setLngLat(lngLat);\n    },\n    draggable(next) {\n      if (this.initial) {\n        return;\n      }\n      this.marker.setDraggable(next);\n    },\n  },\n\n  mounted() {\n    const markerOptions = {\n      ...this.$props,\n    };\n    if (this.$slots.marker) {\n      markerOptions.element = this.$slots.marker[0].elm;\n    }\n    this.marker = new this.mapbox.Marker(markerOptions);\n\n    if (this.$listeners[\"update:coordinates\"]) {\n      this.marker.on(\"dragend\", event => {\n        let newCoordinates;\n        if (this.coordinates instanceof Array) {\n          newCoordinates = [ event.target._lngLat.lng, event.target._lngLat.lat ];\n        } else {\n          newCoordinates = event.target._lngLat;\n        }\n        this.$emit(\"update:coordinates\", newCoordinates);\n      });\n    }\n\n    const eventNames = Object.keys(markerEvents);\n    this.$_bindSelfEvents(eventNames, this.marker);\n\n    this.initial = false;\n    this.$_addMarker();\n  },\n\n  beforeDestroy() {\n    if (this.map !== undefined && this.marker !== undefined) {\n      this.marker.remove();\n    }\n  },\n\n  methods: {\n    $_addMarker() {\n      this.marker.setLngLat(this.coordinates).addTo(this.map);\n      this.$_bindMarkerDOMEvents();\n      this.$_emitEvent(\"added\", { marker: this.marker });\n    },\n\n    $_emitSelfEvent(event) {\n      this.$_emitMapEvent(event, { marker: this.marker });\n    },\n\n    $_bindMarkerDOMEvents() {\n      Object.keys(this.$listeners).forEach(key => {\n        if (Object.values(markerDOMEvents).includes(key)) {\n          this.marker._element.addEventListener(key, event => {\n            this.$_emitSelfEvent(event);\n          });\n        }\n      });\n    },\n\n    remove() {\n      this.marker.remove();\n      this.$_emitEvent(\"removed\");\n    },\n\n    togglePopup() {\n      return this.marker.togglePopup();\n    },\n  },\n};\n</script>\n","import mod from \"-!../../../../../cache-loader/dist/cjs.js??ref--12-0!../../../../../thread-loader/dist/cjs.js!../../../../../babel-loader/lib/index.js!../../../../../cache-loader/dist/cjs.js??ref--0-0!../../../../../vue-loader/lib/index.js??vue-loader-options!./Marker.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../cache-loader/dist/cjs.js??ref--12-0!../../../../../thread-loader/dist/cjs.js!../../../../../babel-loader/lib/index.js!../../../../../cache-loader/dist/cjs.js??ref--0-0!../../../../../vue-loader/lib/index.js??vue-loader-options!./Marker.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Marker.vue?vue&type=template&id=2d111d29&\"\nimport script from \"./Marker.vue?vue&type=script&lang=js&\"\nexport * from \"./Marker.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports"],"sourceRoot":""}