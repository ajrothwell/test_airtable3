{"version":3,"sources":["webpack:///./node_modules/@phila/vue-mapping/src/mapbox/layer/layerMixin.js","webpack:///./node_modules/@phila/vue-mapping/src/mapbox/layer/GeojsonLayer.js","webpack:///./node_modules/@phila/vue-mapping/src/mapbox/lib/withEvents.js","webpack:///./node_modules/@phila/vue-mapping/src/mapbox/lib/layerEvents.js"],"names":["mapboxSourceProps","sourceId","type","String","required","source","Object","default","undefined","mapboxLayerStyleProps","layerId","layer","before","componentProps","clearSource","Boolean","replaceSource","replace","mixins","withEvents","props","inject","data","initial","computed","sourceLoaded","this","map","isSourceLoaded","mapLayer","getLayer","mapSource","getSource","created","minzoom","$watch","next","setLayerZoomRange","maxzoom","paint","keys","prop","setPaintProperty","deep","layout","setLayoutProperty","filter","setFilter","beforeDestroy","removeLayer","err","$_emitEvent","error","removeSource","methods","$_emitLayerMapEvent","event","$_emitMapEvent","$_bindLayerEvents","events","$listeners","forEach","eventName","includes","on","$_unbindEvents","off","$_watchSourceLoading","dataType","move","beforeId","moveLayer","remove","$destroy","render","name","mixin","getSourceFeatures","querySourceFeatures","getRenderedFeatures","geometry","queryRenderedFeatures","layers","getClusterExpansionZoom","clusterId","Promise","resolve","reject","Error","zoom","getClusterChildren","features","getClusterLeaves","args","console","log","setData","$_deferredMount","$props","loadImage","$attrs","icon","image","addImage","bind","addSource","$_addLayer","layerEvents","existed","id","addLayer","setFeatureState","featureId","state","params","getFeatureState","removeFeatureState","sourceLayer","key","$emit","component","mapboxEvent"],"mappings":"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","file":"static/js/pvm_MglGeojsonLayer.js","sourcesContent":["// import withRegistration from \"../../lib/withRegistration\";\r\nimport withEvents from \"../lib/withEvents\";\r\n\r\nconst mapboxSourceProps = {\r\n  sourceId: {\r\n    type: String,\r\n    required: true,\r\n  },\r\n  source: {\r\n    type: [ Object, String ],\r\n    default: undefined,\r\n  },\r\n};\r\n\r\nconst mapboxLayerStyleProps = {\r\n  layerId: {\r\n    type: String,\r\n    required: true,\r\n  },\r\n  layer: {\r\n    type: Object,\r\n    required: true,\r\n  },\r\n  before: {\r\n    type: String,\r\n    default: undefined,\r\n  },\r\n};\r\n\r\nconst componentProps = {\r\n  clearSource: {\r\n    type: Boolean,\r\n    default: true,\r\n  },\r\n  replaceSource: {\r\n    type: Boolean,\r\n    default: false,\r\n  },\r\n  replace: {\r\n    type: Boolean,\r\n    default: false,\r\n  },\r\n};\r\n\r\nexport default {\r\n  mixins: [ withEvents ],\r\n  props: {\r\n    ...mapboxSourceProps,\r\n    ...mapboxLayerStyleProps,\r\n    ...componentProps,\r\n  },\r\n\r\n  inject: [ \"mapbox\", \"map\" ],\r\n\r\n  data() {\r\n    return {\r\n      initial: true,\r\n    };\r\n  },\r\n\r\n  computed: {\r\n    sourceLoaded() {\r\n      return this.map ? this.map.isSourceLoaded(this.sourceId) : false;\r\n    },\r\n    mapLayer() {\r\n      return this.map ? this.map.getLayer(this.layerId) : null;\r\n    },\r\n    mapSource() {\r\n      return this.map ? this.map.getSource(this.sourceId) : null;\r\n    },\r\n  },\r\n\r\n  created() {\r\n    if (this.layer.minzoom) {\r\n      this.$watch(\"layer.minzoom\", function(next) {\r\n        if (this.initial) {\r\n          return;\r\n        }\r\n        this.map.setLayerZoomRange(this.layerId, next, this.layer.maxzoom);\r\n      });\r\n    }\r\n\r\n    if (this.layer.maxzoom) {\r\n      this.$watch(\"layer.maxzoom\", function(next) {\r\n        if (this.initial) {\r\n          return;\r\n        }\r\n        this.map.setLayerZoomRange(this.layerId, this.layer.minzoom, next);\r\n      });\r\n    }\r\n\r\n    if (this.layer.paint) {\r\n      this.$watch(\r\n        \"layer.paint\",\r\n        function(next) {\r\n          if (this.initial) {\r\n            return;\r\n          }\r\n          if (next) {\r\n            for (let prop of Object.keys(next)) {\r\n              this.map.setPaintProperty(this.layerId, prop, next[prop]);\r\n            }\r\n          }\r\n        },\r\n        { deep: true },\r\n      );\r\n    }\r\n\r\n    if (this.layer.layout) {\r\n      this.$watch(\r\n        \"layer.layout\",\r\n        function(next) {\r\n          if (this.initial) {\r\n            return;\r\n          }\r\n          if (next) {\r\n            for (let prop of Object.keys(next)) {\r\n              this.map.setLayoutProperty(this.layerId, prop, next[prop]);\r\n            }\r\n          }\r\n        },\r\n        { deep: true },\r\n      );\r\n    }\r\n\r\n    if (this.layer.filter) {\r\n      this.$watch(\r\n        \"layer.filter\",\r\n        function(next) {\r\n          if (this.initial) {\r\n            return;\r\n          }\r\n          this.map.setFilter(this.layerId, next);\r\n        },\r\n        { deep: true },\r\n      );\r\n    }\r\n\r\n    // if (this.layer.tiles) {\r\n    //   this.$watch(\r\n    //     \"layer\",\r\n    //     function(next) {\r\n    //       console.log('watch layer tiles is firing, next:', next);\r\n    //       if (this.initial) return;\r\n    //       // this.map.removeLayer(this.layerId);\r\n    //       this.map.addLayer(next);\r\n    //       // this.map.setFilter(this.layerId, next);\r\n    //     },\r\n    //     { deep: true }\r\n    //   );\r\n    // }\r\n  },\r\n\r\n  beforeDestroy() {\r\n    // console.log('layerMixin beforeDestroy is running, this.layerId:', this.layerId, 'this.clearSource:', this.clearSource, 'this.map:', this.map, 'this.map.loaded():', this.map.loaded());\r\n    // if (this.map && this.map.loaded()) {\r\n    try {\r\n      // console.log('layerMixin beforeDestroy if map and maploaded try is running')\r\n      this.map.removeLayer(this.layerId);\r\n    } catch (err) {\r\n      // console.log('layerMixin beforeDestroy error 1 is running')\r\n      this.$_emitEvent(\"layer-does-not-exist\", {\r\n        layerId: this.sourceId,\r\n        error: err,\r\n      });\r\n    }\r\n    if (this.clearSource) {\r\n      // console.log('layerMixin beforeDestroy if clearSource is running')\r\n      try {\r\n        // console.log('layerMixin beforeDestroy if clearSource try is running');\r\n        this.map.removeSource(this.sourceId);\r\n      } catch (err) {\r\n        this.$_emitEvent(\"source-does-not-exist\", {\r\n          sourceId: this.sourceId,\r\n          error: err,\r\n        });\r\n      }\r\n    }\r\n    // }\r\n  },\r\n\r\n  methods: {\r\n    $_emitLayerMapEvent(event) {\r\n      return this.$_emitMapEvent(event, { layerId: this.layerId });\r\n    },\r\n\r\n    $_bindLayerEvents(events) {\r\n      Object.keys(this.$listeners).forEach(eventName => {\r\n        if (events.includes(eventName)) {\r\n          this.map.on(eventName, this.layerId, this.$_emitLayerMapEvent);\r\n        }\r\n      });\r\n    },\r\n\r\n    $_unbindEvents(events) {\r\n      if (this.map) {\r\n        events.forEach(eventName => {\r\n          this.map.off(eventName, this.layerId, this.$_emitLayerMapEvent);\r\n        });\r\n      }\r\n    },\r\n\r\n    $_watchSourceLoading(data) {\r\n      if (data.dataType === \"source\" && data.sourceId === this.sourceId) {\r\n        this.$_emitEvent(\"layer-source-loading\", { sourceId: this.sourceId });\r\n        this.map.off(\"dataloading\", this.$_watchSourceLoading);\r\n      }\r\n    },\r\n\r\n    move(beforeId) {\r\n      this.map.moveLayer(this.layerId, beforeId);\r\n      this.$_emitEvent(\"layer-moved\", {\r\n        layerId: this.layerId,\r\n        beforeId: beforeId,\r\n      });\r\n    },\r\n\r\n    remove() {\r\n      this.map.removeLayer(this.layerId);\r\n      this.map.removeSource(this.sourceId);\r\n      this.$_emitEvent(\"layer-removed\", { layerId: this.layerId });\r\n      this.$destroy();\r\n    },\r\n  },\r\n\r\n  render() {},\r\n};\r\n","import layerEvents from \"../lib/layerEvents\";\r\nimport mixin from \"./layerMixin\";\r\n\r\nexport default {\r\n  name: \"GeojsonLayer\",\r\n  mixins: [ mixin ],\r\n\r\n  computed: {\r\n    getSourceFeatures() {\r\n      return filter => {\r\n        if (this.map) {\r\n          return this.map.querySourceFeatures(this.sourceId, { filter });\r\n        }\r\n        return null;\r\n      };\r\n    },\r\n\r\n    getRenderedFeatures() {\r\n      return (geometry, filter) => {\r\n        if (this.map) {\r\n          return this.map.queryRenderedFeatures(geometry, {\r\n            layers: [ this.layerId ],\r\n            filter,\r\n          });\r\n        }\r\n        return null;\r\n      };\r\n    },\r\n\r\n    getClusterExpansionZoom() {\r\n      return clusterId => {\r\n        return new Promise((resolve, reject) => {\r\n          if (this.mapSource) {\r\n            this.mapSource.getClusterExpansionZoom(clusterId, (err, zoom) => {\r\n              if (err) {\r\n                return reject(err);\r\n              }\r\n              return resolve(zoom);\r\n            });\r\n          } else {\r\n            return reject(\r\n              new Error(`Map source with id ${this.sourceId} not found.`),\r\n            );\r\n          }\r\n        });\r\n      };\r\n    },\r\n\r\n    getClusterChildren() {\r\n      return clusterId => {\r\n        return new Promise((resolve, reject) => {\r\n          const source = this.mapSource;\r\n          if (source) {\r\n            source.getClusterChildren(clusterId, (err, features) => {\r\n              if (err) {\r\n                return reject(err);\r\n              }\r\n              return resolve(features);\r\n            });\r\n          } else {\r\n            return reject(\r\n              new Error(`Map source with id ${this.sourceId} not found.`),\r\n            );\r\n          }\r\n        });\r\n      };\r\n    },\r\n\r\n    getClusterLeaves() {\r\n      return (...args) => {\r\n        return new Promise((resolve, reject) => {\r\n          if (this.mapSource) {\r\n            this.mapSource.getClusterLeaves(...args, (err, features) => {\r\n              if (err) {\r\n                return reject(err);\r\n              }\r\n              return resolve(features);\r\n            });\r\n          } else {\r\n            return reject(\r\n              new Error(`Map source with id ${this.sourceId} not found.`),\r\n            );\r\n          }\r\n        });\r\n      };\r\n    },\r\n  },\r\n\r\n  created() {\r\n    console.log('GeojsonLayer.js created is running, this.sourceId:', this.sourceId, 'this.source:', this.source);\r\n    if (this.source) {\r\n      this.$watch(\r\n        \"source.data\",\r\n        function(next) {\r\n          if (this.initial) {\r\n            return;\r\n          }\r\n          this.mapSource.setData(next);\r\n        },\r\n        { deep: true },\r\n      );\r\n    }\r\n    this.$_deferredMount();\r\n  },\r\n\r\n  methods: {\r\n    $_deferredMount() {\r\n      // console.log('GeojsonLayer.js $_deferredMount is running, this.sourceId:', this.sourceId, 'this.source:', this.source);\r\n      // this.map = payload.map;\r\n      this.map.on(\"dataloading\", this.$_watchSourceLoading);\r\n      if (this.source) {\r\n        const source = {\r\n          type: \"geojson\",\r\n          ...this.source,\r\n        };\r\n        try {\r\n          console.log('try map.addSource is starting');\r\n          if (this.$props.layer.layout['icon-image']) {\r\n            this.map.loadImage(\r\n              this.$attrs.icon,\r\n              function(error, image) {\r\n                // console.log('inside loadImage, this.$props.layer.layout[icon-image]:', this.$props.layer.layout['icon-image'], 'image:', image, 'this.$attrs.icon:', this.$attrs.icon);\r\n                this.map.addImage(this.$props.layer.layout['icon-image'], image);\r\n              }.bind(this),\r\n            );\r\n          }\r\n          this.map.addSource(this.sourceId, source);\r\n          // console.log('try map.addSource is ending');\r\n        } catch (err) {\r\n          console.log('catch err is running, err:', err);\r\n          if (this.replaceSource) {\r\n            this.map.removeSource(this.sourceId);\r\n            this.map.addSource(this.sourceId, source);\r\n          }\r\n        }\r\n      }\r\n      // console.log('GeojsonLayer.js $_deferredMount, about to $_addLayer');\r\n      this.$_addLayer();\r\n      // console.log('GeojsonLayer.js $_deferredMount, after $_addLayer');\r\n      this.$_bindLayerEvents(layerEvents);\r\n      this.map.off(\"dataloading\", this.$_watchSourceLoading);\r\n      this.initial = false;\r\n    },\r\n\r\n    $_addLayer() {\r\n      // console.log('GeojsonLayer.js $_addLayer is starting');\r\n      let existed = this.map.getLayer(this.layerId);\r\n      if (existed) {\r\n        if (this.replace) {\r\n          this.map.removeLayer(this.layerId);\r\n        } else {\r\n          this.$_emitEvent(\"layer-exists\", { layerId: this.layerId });\r\n          return existed;\r\n        }\r\n      }\r\n      const layer = {\r\n        id: this.layerId,\r\n        source: this.sourceId,\r\n        ...this.layer,\r\n      };\r\n      console.log('$_addLayer is still running, layer:', layer);\r\n      this.map.addLayer(layer, this.before);\r\n      // console.log('$_addLayer after map.addLayer');\r\n      this.$_emitEvent(\"added\", { layerId: this.layerId });\r\n    },\r\n\r\n    setFeatureState(featureId, state) {\r\n      if (this.map) {\r\n        const params = { id: featureId, source: this.source };\r\n        return this.map.setFeatureState(params, state);\r\n      }\r\n    },\r\n\r\n    getFeatureState(featureId) {\r\n      if (this.map) {\r\n        const params = { id: featureId, source: this.source };\r\n        return this.map.getFeatureState(params);\r\n      }\r\n    },\r\n\r\n    removeFeatureState(featureId, sourceLayer, key) {\r\n      if (this.map) {\r\n        const params = {\r\n          id: featureId,\r\n          source: this.source,\r\n          sourceLayer,\r\n        };\r\n        return this.map.removeFeatureState(params, key);\r\n      }\r\n    },\r\n  },\r\n};\r\n","export default {\r\n  methods: {\r\n    /**\r\n     * Emit Vue event with additional data\r\n     *\r\n     * @param {string} name EventName\r\n     * @param {Object} [data={}] Additional data\r\n     */\r\n    $_emitEvent(name, data = {}) {\r\n      // console.log('$_emitEvent is running, name:', name, 'data:', data, 'this.map:', this.map);\r\n      this.$emit(name, {\r\n        map: this.map,\r\n        component: this,\r\n        ...data,\r\n      });\r\n    },\r\n\r\n    /**\r\n     * Emit Vue event with Mapbox event as additional data\r\n     *\r\n     * @param {Object} event\r\n     */\r\n    $_emitMapEvent(event, data = {}) {\r\n      // console.log('withEvents.js, $_emitMapEvent is running');\r\n      this.$_emitEvent(event.type, { mapboxEvent: event, ...data });\r\n    },\r\n  },\r\n};\r\n","export default [\r\n  \"mousedown\",\r\n  \"mouseup\",\r\n  \"click\",\r\n  \"dblclick\",\r\n  \"mousemove\",\r\n  \"mouseenter\",\r\n  \"mouseleave\",\r\n  \"mouseover\",\r\n  \"mouseout\",\r\n  \"contextmenu\",\r\n  \"touchstart\",\r\n  \"touchend\",\r\n  \"touchcancel\",\r\n];\r\n"],"sourceRoot":""}