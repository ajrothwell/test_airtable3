{"version":3,"sources":["webpack:///./node_modules/@phila/vue-mapping/src/components/PngMarker.vue","webpack:///node_modules/@phila/vue-mapping/src/components/PngMarker.vue","webpack:///./node_modules/@phila/vue-mapping/src/components/PngMarker.vue?9bfe"],"names":["render","staticRenderFns","name","props","watch","rotationAngle","this","latlng","$leafletElement","_map","console","log","nextRotationAngle","removeLayer","map","leafletElement","addTo","mounted","proto_initIcon","proto_setPos","oldIE","iconOptions","options","icon","iconAnchor","rotationOrigin","on","e","target","_applyRotation","_initIcon","call","_setPos","pos","_icon","style","setRotationAngle","angle","update","setRotationOrigin","origin","destroyed","methods","createLeafletElement","iconUrl","iconSize","parentMounted","component"],"mappings":"2IAAIA,EAAQC,E,YCQZ,GACEC,KAAM,YACNC,MAAO,CACT,OACA,SACA,iBAEEC,MAAO,CACLC,cADJ,SACA,GACM,GAAIC,KAAKC,OAAQ,CACXD,KAAKE,iBACHF,KAAKE,gBAAgBC,OACvBC,QAAQC,IAAI,gCAAiCC,GAC7CN,KAAKE,gBAAgBC,KAAKI,YAAYP,KAAKE,kBAG/C,IAAR,mDACA,4BAGYM,GACFC,EAAeC,MAAMF,KAI3BP,OAlBJ,SAkBA,GAEUD,KAAKE,iBACHF,KAAKE,gBAAgBC,MACvBH,KAAKE,gBAAgBC,KAAKI,YAAYP,KAAKE,iBAG/C,IAAN,mDACA,4BAGUM,GACFC,EAAeC,MAAMF,KAI3BG,QAzCF,WA0CI,IAAIC,EAAiB,EAAzB,8BACQC,EAAe,EAAvB,4BAEQC,EAAR,gBAAgB,EAAhB,qBAiEI,GA/DA,EAAJ,kCACM,IAAIC,EAAcf,KAAKgB,QAAQC,MAAQjB,KAAKgB,QAAQC,KAAKD,QACrDE,EAAaH,GAAef,KAAKgB,QAAQC,KAAKD,QAAQE,WACtDA,IACFA,EAAa,EAArB,oBAEMlB,KAAKgB,QAAQG,eAAiBnB,KAAKgB,QAAQG,gBAAkBD,GAAc,gBAC3ElB,KAAKgB,QAAQjB,cAAgBC,KAAKgB,QAAQjB,eAAiB,EAK3DC,KAAKoB,GAAG,QAAQ,SAAtB,GACQC,EAAEC,OAAOC,uBAIb,EAAJ,mBACMC,UAAW,WAETZ,EAAea,KAAKzB,OAGtB0B,QAAS,SAAf,GAEQb,EAAaY,KAAKzB,KAAM2B,GACxB3B,KAAKuB,kBAGPA,eAAgB,WACtB,6BAEUvB,KAAK4B,MAAMC,MAAM,EAA3B,2DAEA,EAGY7B,KAAK4B,MAAMC,MAAM,EAA7B,kEAIY7B,KAAK4B,MAAMC,MAAM,EAA7B,sEAOMC,iBAAkB,SAAxB,GAIQ,OAFA9B,KAAKgB,QAAQjB,cAAgBgC,EAC7B/B,KAAKgC,SACEhC,MAGTiC,kBAAmB,SAAzB,GAIQ,OAFAjC,KAAKgB,QAAQG,eAAiBe,EAC9BlC,KAAKgC,SACEhC,QAIPA,KAAKC,OAAQ,CACf,IAAN,mDACA,4BAGUO,GACFC,EAAeC,MAAMF,KAK3B2B,UAzHF,WA2HInC,KAAKE,gBAAgBC,KAAKI,YAAYP,KAAKE,kBAE7CkC,QAAS,CACPC,qBADJ,WAIM,IAAN,aACQC,QAAStC,KAAKiB,KACdsB,SAAU,CAAC,GAAnB,IACQrB,WAAY,CAAC,GAArB,KAIM,OAAO,EAAb,uBACQD,KAAMA,EACNlB,cAAeC,KAAKD,iBAGxByC,cAhBJ,SAgBA,GACM,IAAN,oBACMxC,KAAKE,gBAAgBQ,MAAMF,KAG/Bd,OAlJF,SAkJA,MC1JgT,I,YFO5S+C,EAAY,eACd,EACA/C,EACAC,GACA,EACA,KACA,KACA,MAIa,aAAA8C,E","file":"static/js/mbmp_pvm_PngMarker.js","sourcesContent":["var render, staticRenderFns\nimport script from \"./PngMarker.vue?vue&type=script&lang=js&\"\nexport * from \"./PngMarker.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","<!--\n  wraps Leaflet.vector-markers as a vue component\n  https://github.com/hiasinho/Leaflet.vector-markers\n-->\n\n<script>\nimport * as L from 'leaflet';\n\nexport default {\n  name: 'PngMarker',\n  props: [\n    'icon',\n    'latlng',\n    'rotationAngle',\n  ],\n  watch: {\n    rotationAngle(nextRotationAngle) {\n      if (this.latlng) {\n        if (this.$leafletElement) {\n          if (this.$leafletElement._map) {\n            console.log('pngMarker orientation changed', nextRotationAngle);\n            this.$leafletElement._map.removeLayer(this.$leafletElement);\n          }\n        }\n        const leafletElement = this.$leafletElement = this.createLeafletElement();\n        const map = this.$store.state.map.map;\n\n        // REVIEW kind of hacky/not reactive?\n        if (map) {\n          leafletElement.addTo(map);\n        }\n      }\n    },\n    latlng(nextLatLng) {\n      // console.log('pngMarker orientation changed', nextRotationAngle);\n      if (this.$leafletElement) {\n        if (this.$leafletElement._map) {\n          this.$leafletElement._map.removeLayer(this.$leafletElement);\n        }\n      }\n      const leafletElement = this.$leafletElement = this.createLeafletElement();\n      const map = this.$store.state.map.map;\n\n      // REVIEW kind of hacky/not reactive?\n      if (map) {\n        leafletElement.addTo(map);\n      }\n    },\n  },\n  mounted() {\n    var proto_initIcon = L.Marker.prototype._initIcon;\n    var proto_setPos = L.Marker.prototype._setPos;\n\n    var oldIE = (L.DomUtil.TRANSFORM === 'msTransform');\n\n    L.Marker.addInitHook(function () {\n      var iconOptions = this.options.icon && this.options.icon.options;\n      var iconAnchor = iconOptions && this.options.icon.options.iconAnchor;\n      if (iconAnchor) {\n        iconAnchor = (iconAnchor[0] + 'px ' + iconAnchor[1] + 'px');\n      }\n      this.options.rotationOrigin = this.options.rotationOrigin || iconAnchor || 'center bottom' ;\n      this.options.rotationAngle = this.options.rotationAngle || 0;\n\n      // console.log('PngMarker addInitHook, iconOptions:', iconOptions, 'iconAnchor:', iconAnchor, 'this.options.rotationOrigin:', this.options.rotationOrigin, 'this.options.rotationAngle:', this.options.rotationAngle);\n\n      // Ensure marker keeps rotated during dragging\n      this.on('drag', function(e) {\n        e.target._applyRotation();\n      });\n    });\n\n    L.Marker.include({\n      _initIcon: function() {\n        // console.log('_initIcon is running');\n        proto_initIcon.call(this);\n      },\n\n      _setPos: function (pos) {\n        // console.log('_setPos is running, pos:', pos);\n        proto_setPos.call(this, pos);\n        this._applyRotation();\n      },\n\n      _applyRotation: function () {\n        if(this.options.rotationAngle) {\n          // console.log('PngMarker _applyRotation is running, this.options.rotationAngle:', this.options.rotationAngle);\n          this._icon.style[L.DomUtil.TRANSFORM+'Origin'] = this.options.rotationOrigin;\n\n          if(oldIE) {\n            // for IE 9, use the 2D rotation\n            // console.log('oldIE');\n            this._icon.style[L.DomUtil.TRANSFORM] = 'rotate(' + this.options.rotationAngle + 'deg)';\n          } else {\n            // for modern browsers, prefer the 3D accelerated version\n            // console.log('notOldIE');\n            this._icon.style[L.DomUtil.TRANSFORM] += ' rotate(' + this.options.rotationAngle + 'deg)';\n            // this._icon.style[L.DomUtil.TRANSFORM] += ' rotateZ(' + this.options.rotationAngle + 'deg)';\n            // this.setRotationAngle(this.options.rotationAngle);\n          }\n        }\n      },\n\n      setRotationAngle: function(angle) {\n        // console.log('PngMarker setRotationAngle is running');\n        this.options.rotationAngle = angle;\n        this.update();\n        return this;\n      },\n\n      setRotationOrigin: function(origin) {\n        // console.log('PngMarker setRotationOrigin is running');\n        this.options.rotationOrigin = origin;\n        this.update();\n        return this;\n      },\n    });\n\n    if (this.latlng) {\n      const leafletElement = this.$leafletElement = this.createLeafletElement();\n      const map = this.$store.state.map.map;\n\n      // REVIEW kind of hacky/not reactive?\n      if (map) {\n        leafletElement.addTo(map);\n        // console.log('leafletElement:', leafletElement);\n      }\n    }\n  },\n  destroyed() {\n    // console.log('pngMarker destroyed fired, latlng is', this.latlng);\n    this.$leafletElement._map.removeLayer(this.$leafletElement);\n  },\n  methods: {\n    createLeafletElement() {\n      // console.log('pngMarker createLeafletElement is running');\n\n      const icon = L.icon({\n        iconUrl: this.icon,\n        iconSize: [ 26, 16 ],\n        iconAnchor: [ 11, 8 ],\n      });\n\n      // console.log('createLeafletElement is running, this.latlng:', this.latlng);\n      return L.marker(this.latlng, {\n        icon: icon,\n        rotationAngle: this.rotationAngle,\n      });\n    },\n    parentMounted(parent) {\n      const map = parent.$leafletElement;\n      this.$leafletElement.addTo(map);\n    },\n  },\n  render(h) {\n    // for some reason, the react prop that `this.orientation` depends on has\n    // to be evaluated once in order to receive updates.\n    // this.orientation;\n\n    return;\n  },\n};\n</script>\n","import mod from \"-!../../../../cache-loader/dist/cjs.js??ref--12-0!../../../../thread-loader/dist/cjs.js!../../../../babel-loader/lib/index.js!../../../../cache-loader/dist/cjs.js??ref--0-0!../../../../vue-loader/lib/index.js??vue-loader-options!./PngMarker.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../cache-loader/dist/cjs.js??ref--12-0!../../../../thread-loader/dist/cjs.js!../../../../babel-loader/lib/index.js!../../../../cache-loader/dist/cjs.js??ref--0-0!../../../../vue-loader/lib/index.js??vue-loader-options!./PngMarker.vue?vue&type=script&lang=js&\""],"sourceRoot":""}