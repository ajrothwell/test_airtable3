{"version":3,"sources":["webpack:///./node_modules/@phila/vue-mapping/src/components/PngMarker.vue","webpack:///node_modules/@phila/vue-mapping/src/components/PngMarker.vue","webpack:///./node_modules/@phila/vue-mapping/src/components/PngMarker.vue?9bfe"],"names":["render","staticRenderFns","name","props","watch","rotationAngle","this","latlng","$leafletElement","_map","console","log","nextRotationAngle","removeLayer","map","leafletElement","addTo","mounted","proto_initIcon","proto_setPos","oldIE","iconOptions","options","icon","iconAnchor","rotationOrigin","on","e","target","_applyRotation","_initIcon","call","_setPos","pos","_icon","style","setRotationAngle","angle","update","setRotationOrigin","origin","destroyed","methods","createLeafletElement","iconUrl","iconSize","parentMounted","component"],"mappings":"2IAAIA,EAAQC,E,YCQZ,GACEC,KAAM,YACNC,MAAO,CACT,OACA,SACA,iBAEEC,MAAO,CACLC,cADJ,SACA,GACM,GAAIC,KAAKC,OAAQ,CACXD,KAAKE,iBACHF,KAAKE,gBAAgBC,OACvBC,QAAQC,IAAI,gCAAiCC,GAC7CN,KAAKE,gBAAgBC,KAAKI,YAAYP,KAAKE,kBAG/C,IAAR,mDACA,4BAGYM,GACFC,EAAeC,MAAMF,KAI3BP,OAlBJ,SAkBA,GAEUD,KAAKE,iBACHF,KAAKE,gBAAgBC,MACvBH,KAAKE,gBAAgBC,KAAKI,YAAYP,KAAKE,iBAG/C,IAAN,mDACA,4BAGUM,GACFC,EAAeC,MAAMF,KAI3BG,QAzCF,WA0CI,IAAIC,EAAiB,EAAzB,8BACQC,EAAe,EAAvB,4BAEQC,EAAR,gBAAgB,EAAhB,qBAiEI,GA/DA,EAAJ,kCACM,IAAIC,EAAcf,KAAKgB,QAAQC,MAAQjB,KAAKgB,QAAQC,KAAKD,QACrDE,EAAaH,GAAef,KAAKgB,QAAQC,KAAKD,QAAQE,WACtDA,IACFA,EAAa,EAArB,oBAEMlB,KAAKgB,QAAQG,eAAiBnB,KAAKgB,QAAQG,gBAAkBD,GAAc,gBAC3ElB,KAAKgB,QAAQjB,cAAgBC,KAAKgB,QAAQjB,eAAiB,EAK3DC,KAAKoB,GAAG,QAAQ,SAAtB,GACQC,EAAEC,OAAOC,uBAIb,EAAJ,mBACMC,UAAW,WAETZ,EAAea,KAAKzB,OAGtB0B,QAAS,SAAf,GAEQb,EAAaY,KAAKzB,KAAM2B,GACxB3B,KAAKuB,kBAGPA,eAAgB,WACtB,6BAEUvB,KAAK4B,MAAMC,MAAM,EAA3B,2DAEA,EAGY7B,KAAK4B,MAAMC,MAAM,EAA7B,kEAIY7B,KAAK4B,MAAMC,MAAM,EAA7B,sEAOMC,iBAAkB,SAAxB,GAIQ,OAFA9B,KAAKgB,QAAQjB,cAAgBgC,EAC7B/B,KAAKgC,SACEhC,MAGTiC,kBAAmB,SAAzB,GAIQ,OAFAjC,KAAKgB,QAAQG,eAAiBe,EAC9BlC,KAAKgC,SACEhC,QAIPA,KAAKC,OAAQ,CACf,IAAN,mDACA,4BAGUO,GACFC,EAAeC,MAAMF,KAK3B2B,UAzHF,WA2HInC,KAAKE,gBAAgBC,KAAKI,YAAYP,KAAKE,kBAE7CkC,QAAS,CACPC,qBADJ,WAIM,IAAN,aACQC,QAAStC,KAAKiB,KACdsB,SAAU,CAAC,GAAnB,IACQrB,WAAY,CAAC,GAArB,KAIM,OAAO,EAAb,uBACQD,KAAMA,EACNlB,cAAeC,KAAKD,iBAGxByC,cAhBJ,SAgBA,GACM,IAAN,oBACMxC,KAAKE,gBAAgBQ,MAAMF,KAG/Bd,OAlJF,SAkJA,MC1JgT,I,YFO5S+C,EAAY,eACd,EACA/C,EACAC,GACA,EACA,KACA,KACA,MAIa,aAAA8C,E","file":"static/js/mbmp_pvm_PngMarker.js","sourcesContent":["var render, staticRenderFns\nimport script from \"./PngMarker.vue?vue&type=script&lang=js&\"\nexport * from \"./PngMarker.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","<!--\r\n  wraps Leaflet.vector-markers as a vue component\r\n  https://github.com/hiasinho/Leaflet.vector-markers\r\n-->\r\n\r\n<script>\r\nimport * as L from 'leaflet';\r\n\r\nexport default {\r\n  name: 'PngMarker',\r\n  props: [\r\n    'icon',\r\n    'latlng',\r\n    'rotationAngle',\r\n  ],\r\n  watch: {\r\n    rotationAngle(nextRotationAngle) {\r\n      if (this.latlng) {\r\n        if (this.$leafletElement) {\r\n          if (this.$leafletElement._map) {\r\n            console.log('pngMarker orientation changed', nextRotationAngle);\r\n            this.$leafletElement._map.removeLayer(this.$leafletElement);\r\n          }\r\n        }\r\n        const leafletElement = this.$leafletElement = this.createLeafletElement();\r\n        const map = this.$store.state.map.map;\r\n\r\n        // REVIEW kind of hacky/not reactive?\r\n        if (map) {\r\n          leafletElement.addTo(map);\r\n        }\r\n      }\r\n    },\r\n    latlng(nextLatLng) {\r\n      // console.log('pngMarker orientation changed', nextRotationAngle);\r\n      if (this.$leafletElement) {\r\n        if (this.$leafletElement._map) {\r\n          this.$leafletElement._map.removeLayer(this.$leafletElement);\r\n        }\r\n      }\r\n      const leafletElement = this.$leafletElement = this.createLeafletElement();\r\n      const map = this.$store.state.map.map;\r\n\r\n      // REVIEW kind of hacky/not reactive?\r\n      if (map) {\r\n        leafletElement.addTo(map);\r\n      }\r\n    },\r\n  },\r\n  mounted() {\r\n    var proto_initIcon = L.Marker.prototype._initIcon;\r\n    var proto_setPos = L.Marker.prototype._setPos;\r\n\r\n    var oldIE = (L.DomUtil.TRANSFORM === 'msTransform');\r\n\r\n    L.Marker.addInitHook(function () {\r\n      var iconOptions = this.options.icon && this.options.icon.options;\r\n      var iconAnchor = iconOptions && this.options.icon.options.iconAnchor;\r\n      if (iconAnchor) {\r\n        iconAnchor = (iconAnchor[0] + 'px ' + iconAnchor[1] + 'px');\r\n      }\r\n      this.options.rotationOrigin = this.options.rotationOrigin || iconAnchor || 'center bottom' ;\r\n      this.options.rotationAngle = this.options.rotationAngle || 0;\r\n\r\n      // console.log('PngMarker addInitHook, iconOptions:', iconOptions, 'iconAnchor:', iconAnchor, 'this.options.rotationOrigin:', this.options.rotationOrigin, 'this.options.rotationAngle:', this.options.rotationAngle);\r\n\r\n      // Ensure marker keeps rotated during dragging\r\n      this.on('drag', function(e) {\r\n        e.target._applyRotation();\r\n      });\r\n    });\r\n\r\n    L.Marker.include({\r\n      _initIcon: function() {\r\n        // console.log('_initIcon is running');\r\n        proto_initIcon.call(this);\r\n      },\r\n\r\n      _setPos: function (pos) {\r\n        // console.log('_setPos is running, pos:', pos);\r\n        proto_setPos.call(this, pos);\r\n        this._applyRotation();\r\n      },\r\n\r\n      _applyRotation: function () {\r\n        if(this.options.rotationAngle) {\r\n          // console.log('PngMarker _applyRotation is running, this.options.rotationAngle:', this.options.rotationAngle);\r\n          this._icon.style[L.DomUtil.TRANSFORM+'Origin'] = this.options.rotationOrigin;\r\n\r\n          if(oldIE) {\r\n            // for IE 9, use the 2D rotation\r\n            // console.log('oldIE');\r\n            this._icon.style[L.DomUtil.TRANSFORM] = 'rotate(' + this.options.rotationAngle + 'deg)';\r\n          } else {\r\n            // for modern browsers, prefer the 3D accelerated version\r\n            // console.log('notOldIE');\r\n            this._icon.style[L.DomUtil.TRANSFORM] += ' rotate(' + this.options.rotationAngle + 'deg)';\r\n            // this._icon.style[L.DomUtil.TRANSFORM] += ' rotateZ(' + this.options.rotationAngle + 'deg)';\r\n            // this.setRotationAngle(this.options.rotationAngle);\r\n          }\r\n        }\r\n      },\r\n\r\n      setRotationAngle: function(angle) {\r\n        // console.log('PngMarker setRotationAngle is running');\r\n        this.options.rotationAngle = angle;\r\n        this.update();\r\n        return this;\r\n      },\r\n\r\n      setRotationOrigin: function(origin) {\r\n        // console.log('PngMarker setRotationOrigin is running');\r\n        this.options.rotationOrigin = origin;\r\n        this.update();\r\n        return this;\r\n      },\r\n    });\r\n\r\n    if (this.latlng) {\r\n      const leafletElement = this.$leafletElement = this.createLeafletElement();\r\n      const map = this.$store.state.map.map;\r\n\r\n      // REVIEW kind of hacky/not reactive?\r\n      if (map) {\r\n        leafletElement.addTo(map);\r\n        // console.log('leafletElement:', leafletElement);\r\n      }\r\n    }\r\n  },\r\n  destroyed() {\r\n    // console.log('pngMarker destroyed fired, latlng is', this.latlng);\r\n    this.$leafletElement._map.removeLayer(this.$leafletElement);\r\n  },\r\n  methods: {\r\n    createLeafletElement() {\r\n      // console.log('pngMarker createLeafletElement is running');\r\n\r\n      const icon = L.icon({\r\n        iconUrl: this.icon,\r\n        iconSize: [ 26, 16 ],\r\n        iconAnchor: [ 11, 8 ],\r\n      });\r\n\r\n      // console.log('createLeafletElement is running, this.latlng:', this.latlng);\r\n      return L.marker(this.latlng, {\r\n        icon: icon,\r\n        rotationAngle: this.rotationAngle,\r\n      });\r\n    },\r\n    parentMounted(parent) {\r\n      const map = parent.$leafletElement;\r\n      this.$leafletElement.addTo(map);\r\n    },\r\n  },\r\n  render(h) {\r\n    // for some reason, the react prop that `this.orientation` depends on has\r\n    // to be evaluated once in order to receive updates.\r\n    // this.orientation;\r\n\r\n    return;\r\n  },\r\n};\r\n</script>\r\n","import mod from \"-!../../../../cache-loader/dist/cjs.js??ref--12-0!../../../../thread-loader/dist/cjs.js!../../../../babel-loader/lib/index.js!../../../../cache-loader/dist/cjs.js??ref--0-0!../../../../vue-loader/lib/index.js??vue-loader-options!./PngMarker.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../cache-loader/dist/cjs.js??ref--12-0!../../../../thread-loader/dist/cjs.js!../../../../babel-loader/lib/index.js!../../../../cache-loader/dist/cjs.js??ref--0-0!../../../../vue-loader/lib/index.js??vue-loader-options!./PngMarker.vue?vue&type=script&lang=js&\""],"sourceRoot":""}